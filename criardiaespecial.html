<!doctype html>
<html>
<head>
<script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="index2.css"/>
<meta charset="UTF-8">
<title>Salão</title>
<script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
<!--<script src="index.js"></script>-->
<link href="https://fonts.googleapis.com/css?family=Righteous" rel="stylesheet">

</head>

<body>

<header>
    <div class="bloco">
        <div class="bloco1">
            <img id="logo" src="img/logo.png"/>
        </div>
        
        <div class="bloco1" style="padding-top: 30px;padding-right: -30px; width: 350px;">
        </div>

    </div>
</header>

    
<div class="blocoMenu">
    <div>
        <a href="index.html"><button type="button">Home</button></a>
    </div>
    <div>
        <a href="listardiasrspeciais.html"><button type="button">Listar dias Especiais</button></a>
    </div>
</div>

<div style="text-align: center; font-size: 22px; width: 520px; height: auto; font-family: 'Righteous', cursive;
    margin: 1px auto 15px auto; text-decoration: underline;">    
    <span>
        Criar Dia Especial
    </span>
</div>

<div style="font-size: 22px; width: 630px; height: auto; font-family: 'Righteous', cursive;
    margin: 1px auto 15px auto;">    
    <table id="tblincluir">			
        <tr>
            <td>Nome do Evento: </td>
            <td><input type="text" class="texto" id="nome_evento" maxlength="50"/></td>
         </tr>
         <tr>
            <td>Data: </td>
            <td><input type="date" class="texto" id="data_evento"/></td>
         </tr>
         
         <tr>
             <td><p>Hora de Início::</p></td>
             <td>
                <select id="horaDeInicio" class="texto" style="font-size: 15px; width: 200px; text-align: center;">
                    <option value=0>--:--</option>
                        <option value=1>05:00</option>
                        <option value=2>05:15</option>
                        <option value=3>05:30</option>
                        <option value=4>05:45</option>
                        <option value=5>06:00</option>
                        <option value=6>06:15</option>
                        <option value=7>06:30</option>
                        <option value=8>06:45</option>
                        <option value=9>07:00</option>
                        <option value=10>07:15</option>
                        <option value=11>07:30</option>
                        <option value=12>07:45</option>
                        <option value=13>08:00</option>
                        <option value=14>08:15</option>
                        <option value=15>08:30</option>
                        <option value=16>08:45</option>
                        <option value=17>09:00</option>
                        <option value=18>09:15</option>
                        <option value=19>09:30</option>
                        <option value=20>09:45</option>
                        <option value=21>10:00</option>
                        <option value=22>10:15</option>
                        <option value=23>10:30</option>
                        <option value=24>10:45</option>
                        <option value=25>11:00</option>
                        <option value=26>11:15</option>
                        <option value=27>11:30</option>
                        <option value=28>11:45</option>
                        <option value=29>12:00</option>
                        <option value=30>12:15</option>
                        <option value=31>12:30</option>
                        <option value=32>12:45</option>
                        <option value=33>13:00</option>
                        <option value=34>13:15</option>
                        <option value=35>13:30</option>
                        <option value=36>13:45</option>
                        <option value=37>14:00</option>
                        <option value=38>14:15</option>
                        <option value=39>14:30</option>
                        <option value=40>14:45</option>
                        <option value=41>15:00</option>
                        <option value=42>15:15</option>
                        <option value=43>15:30</option>
                        <option value=44>15:45</option>
                        <option value=45>16:00</option>
                        <option value=46>16:15</option>
                        <option value=47>16:30</option>
                        <option value=48>16:45</option>
                        <option value=49>17:00</option>
                        <option value=50>17:15</option>
                        <option value=51>17:30</option>
                        <option value=52>17:45</option>
                        <option value=53>18:00</option>
                        <option value=54>18:15</option>
                        <option value=55>18:30</option>
                        <option value=56>18:45</option>
                        <option value=57>19:00</option>
                        <option value=58>19:15</option>
                        <option value=59>19:30</option>
                        <option value=60>19:45</option>
                        <option value=61>20:00</option>
                        <option value=62>20:15</option>
                        <option value=63>20:30</option>
                        <option value=64>20:45</option>
                        <option value=65>21:00</option>
                        <option value=66>21:15</option>
                        <option value=67>21:30</option>
                        <option value=68>21:45</option>
                        <option value=69>22:00</option>
                        <option value=70>22:15</option>
                        <option value=71>22:30</option>
                        <option value=72>22:45</option>
                        <option value=73>23:00</option>
                        <option value=74>23:15</option>
                        <option value=75>23:30</option>
                        <option value=76>23:45</option>
                        <option value=77>24:00</option>
                        <option value=78>24:15</option>
                        <option value=79>24:30</option>
                        <option value=80>24:45</option>
                        <option value=81>1:00</option>
                        <option value=82>1:15</option>
                        <option value=83>1:30</option>
                        <option value=84>1:45</option>
                </select>
            </td>
         </tr>
         <tr>
             <td><p>Hora de Término:</p></td>
             <td>
                <select id="horaDeTermino" class="texto" onchange="checarHorarios();" style="font-size: 15px; width: 200px; text-align: center;">
                    <option value=0>--:--</option>
                        <option value=1>05:00</option>
                        <option value=2>05:15</option>
                        <option value=3>05:30</option>
                        <option value=4>05:45</option>
                        <option value=5>06:00</option>
                        <option value=6>06:15</option>
                        <option value=7>06:30</option>
                        <option value=8>06:45</option>
                        <option value=9>07:00</option>
                        <option value=10>07:15</option>
                        <option value=11>07:30</option>
                        <option value=12>07:45</option>
                        <option value=13>08:00</option>
                        <option value=14>08:15</option>
                        <option value=15>08:30</option>
                        <option value=16>08:45</option>
                        <option value=17>09:00</option>
                        <option value=18>09:15</option>
                        <option value=19>09:30</option>
                        <option value=20>09:45</option>
                        <option value=21>10:00</option>
                        <option value=22>10:15</option>
                        <option value=23>10:30</option>
                        <option value=24>10:45</option>
                        <option value=25>11:00</option>
                        <option value=26>11:15</option>
                        <option value=27>11:30</option>
                        <option value=28>11:45</option>
                        <option value=29>12:00</option>
                        <option value=30>12:15</option>
                        <option value=31>12:30</option>
                        <option value=32>12:45</option>
                        <option value=33>13:00</option>
                        <option value=34>13:15</option>
                        <option value=35>13:30</option>
                        <option value=36>13:45</option>
                        <option value=37>14:00</option>
                        <option value=38>14:15</option>
                        <option value=39>14:30</option>
                        <option value=40>14:45</option>
                        <option value=41>15:00</option>
                        <option value=42>15:15</option>
                        <option value=43>15:30</option>
                        <option value=44>15:45</option>
                        <option value=45>16:00</option>
                        <option value=46>16:15</option>
                        <option value=47>16:30</option>
                        <option value=48>16:45</option>
                        <option value=49>17:00</option>
                        <option value=50>17:15</option>
                        <option value=51>17:30</option>
                        <option value=52>17:45</option>
                        <option value=53>18:00</option>
                        <option value=54>18:15</option>
                        <option value=55>18:30</option>
                        <option value=56>18:45</option>
                        <option value=57>19:00</option>
                        <option value=58>19:15</option>
                        <option value=59>19:30</option>
                        <option value=60>19:45</option>
                        <option value=61>20:00</option>
                        <option value=62>20:15</option>
                        <option value=63>20:30</option>
                        <option value=64>20:45</option>
                        <option value=65>21:00</option>
                        <option value=66>21:15</option>
                        <option value=67>21:30</option>
                        <option value=68>21:45</option>
                        <option value=69>22:00</option>
                        <option value=70>22:15</option>
                        <option value=71>22:30</option>
                        <option value=72>22:45</option>
                        <option value=73>23:00</option>
                        <option value=74>23:15</option>
                        <option value=75>23:30</option>
                        <option value=76>23:45</option>
                        <option value=77>24:00</option>
                        <option value=78>24:15</option>
                        <option value=79>24:30</option>
                        <option value=80>24:45</option>
                        <option value=81>1:00</option>
                        <option value=82>1:15</option>
                        <option value=83>1:30</option>
                        <option value=84>1:45</option>
                </select>
            </td>
         <tr>
            <td>Duração: </td>
            <td>
                <input type="radio" name="periodo" value="15 Minutos" id="15Minutos" checked/>&nbsp;<label for="15Minutos">15 Minutos</label>&nbsp; &nbsp;<br>
                <input type="radio" name="periodo" value="30 Minutos" id="30Minutos"/>&nbsp;<label for="30Minutos">30 Minutos</label><br>
                <input type="radio" name="periodo" value="45 Minutos" id="45Minutos"/>&nbsp;<label for="45Minutos">45 Minutos</label><br>
                <input type="radio" name="periodo" value="1 Hora" id="1Hora"/>&nbsp;<label for="1Hora">1 Hora</label><br>
                <input type="radio" name="periodo" value="1 Hora e 30" id="1HoraE30"/>&nbsp;<label for="1HoraE30">1 Hora e 30</label><br>
                <input type="radio" name="periodo" value="2 Horas" id="2Horas"/>&nbsp;<label for="2Horas">2 Horas</label>
            </td>
	</tr>
        <tr>
            <td>Valor: </td>
            <td>€<input type="number" class="texto" id="valor" min='0.00' max='1000.00' step='0.05' style="width:100px;" onchange="changeValor();"/></td>
         </tr>
         <tr>
            <td>Cabeçalho: </td>
            <td><input type="text" class="texto" id="cabecalho_evento" maxlength="50"/></td>
         </tr>
         <tr>
            <td>Texto Principal: </td>
            <td><input type="text" class="texto" id="textoprincipal_evento" maxlength="100"/></td>
         </tr>
         <tr>
            <td>Texto Secundário: </td>
            <td><input type="text" class="texto" id="textosecundario_evento" maxlength="100"/></td>
         </tr>
         <tr>
            <td>Rodapé: </td>
            <td><input type="text" class="texto" id="rodape_evento" maxlength="50"/></td>
         </tr>
         
    </table>
</div>

<div style="text-align: center; font-size: 22px; width: 520px; height: auto; font-family: 'Righteous', cursive;
    margin: 1px auto 15px auto;">    
    <span>
        Inclua uma imagem do Dia Especial:
    </span>
</div>

    <div class="incluirProfDentro1" style="height: 280px;">
    <div>
        <img src="" style=" margin-left: auto; margin-right: auto;" height="200" id="image">
        <input type="file" id="file" onchange="showImage.call(this)" hidden ="hidden" />
<!--    <div class="blocoImagem">
        <span id="custom_text" style="margin-left: 0px; margin-top: 0px;">Nenhuma imagem escolhida ainda.</span>
        </div>-->
        <!--<button type="button" id="custom_button" style="margin-top: 20px;">Escolha uma Imagem</button>-->
        <button type="button" id="custom_btn" style="margin-top: 20px; margin-left: 110px;">Escolha uma Imagem</button>
    </div> 
</div>

<div id="progressBar">
    <p id="textoProgresso" style="text-align: center; height: 5px;"></p>
        <div style="text-align: center; margin-top: -21px;"  id="progresso">
                 
        </div>
</div>
    
<div style="text-align: center; font-size: 22px; width: 520px; height: auto; font-family: 'Righteous', cursive;
    margin: 1px auto 15px auto;">    
    <div class="incluirProfDentro2">
        <button type="button" style="margin-top: 20px; margin-left: 14px" id="btnSalvar" onclick="uploadFile();">Salvar</button>
    </div>
</div>
    
<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCRHDyxKv5kY3aq5LzLNlwrjqAxbtCEzuw",
    authDomain: "salao15mingeral.firebaseapp.com",
    databaseURL: "https://salao15mingeral.firebaseio.com",
    projectId: "salao15mingeral",
    storageBucket: "salao15mingeral.appspot.com",
    messagingSenderId: "645464575134",
    appId: "1:645464575134:web:a5fe8ce802fe35fd"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>

<script>
    var valor=0;
    
    function checarHorarios(){
        var hora_inicio = parseInt(document.getElementById('horaDeInicio').value);
        var hora_termino = parseInt(document.getElementById('horaDeTermino').value);
        if(hora_inicio>hora_termino){
            alert('Horário de Término tem que ser maiór que horário de Início');
            document.getElementById('horaDeTermino').value=0;
        }
        //alert('checarHorarios()');
    }
    
    
    window.onload = function() {
      //initApp();
      document.getElementById('btnSalvar').disabled = false;
    };
    
    document.getElementById('btnSalvar').disabled = true;

    document.getElementById('progressBar').style.display = "none";

    document.getElementById('image').src = "img/semimagem.png";
    document.getElementById('image').style = "margin-left: 100px;";

    document.getElementById("nome_evento").focus();

    //Area referente ao botao de upload de imagem
    const realFileBtn = document.getElementById('file');
    const customBtn = document.getElementById('custom_btn');
    const customTxt = document.getElementById('custom_text');

    customBtn.addEventListener("click", function(){
        realFileBtn.click();
    });
    realFileBtn.addEventListener("change", function(){
//        if(realFileBtn.value){
//            customTxt.innerHTML=realFileBtn.value.match();
//        }else{
//            customTxt.innerHTML="Arquivo ainda não encontrado.";
//        }
    });
    
    function changeValor(){
        var valorDigitado = document.getElementById("valor").value;
        valor = Number(valorDigitado).toFixed(2);
        //alert("valor = "+valor);
        //var valorToString = valor.toString();
        //alert("valorToString = "+valorToString);
        //var valorShow = "€"+valorToString;
        //alert("valorShow = "+valorShow);
        document.getElementById("valor").value=valor;
    }
    
    function showImage(){
    if(this.files && this.files[0]){
        var obj = new FileReader();
        obj.onload = function(data){
            var image = document.getElementById("image");
            image.src = data.target.result;
            image.style.display = "block";
            };
        obj.readAsDataURL(this.files[0]);
        }
    }
    
    var el = document.getElementById("progresso");
    var txtprogress = document.getElementById("textoProgresso");
    var width = 1;
        
    var selectedFile;
    $("#file").on("change", function(event){
        $("#upload_btn").show(); 
        selectedFile = event.target.files[0];
    });
    
    function uploadFile(){
        var hora=0;
        var nome_evento = document.getElementById('nome_evento').value;
        var data_evento = document.getElementById('data_evento').value;
        var hora_inicio = parseInt(document.getElementById('horaDeInicio').value);
        var hora_termino = parseInt(document.getElementById('horaDeTermino').value);
        var cabecalho_evento = document.getElementById('cabecalho_evento').value;
        var textoprincipal_evento = document.getElementById('textoprincipal_evento').value;
        var textosecundario_evento = document.getElementById('textosecundario_evento').value;
        var rodape_evento = document.getElementById('rodape_evento').value;
        
        if(hora_inicio<hora_termino && hora_inicio>0){
            var horas = document.getElementsByName('periodo');
            for(var i=0; i<horas.length; i++){
                if(horas[i].checked){
                    hora=horas[i].value;
                }
            }

            document.getElementById('progressBar').style.display = "block";

            if(nome_evento && data_evento){
                if(selectedFile){
                var fileName = selectedFile.name;
            }else{
                alert('Imagem não foi selecionada corretamente...');
                document.getElementById('progressBar').style.display = "none";
            }

            var storageRef = firebase.storage().ref('/images/' + fileName);
            var uploadTask = storageRef.put(selectedFile);


            uploadTask.on('state_changed', function(snapshot){
            // Observe state change events such as progress, pause, and resume
            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            txtprogress.innerHTML=""+progress.toFixed(0)+"% concluído";
            //el.style.width = progress + '% done';
            el.style.width = ""+progress+"%";
            switch (snapshot.state) {
                case firebase.storage.TaskState.PAUSED: // or 'paused'
                    console.log('Upload is paused');
                    break;
                case firebase.storage.TaskState.RUNNING: // or 'running'
                    console.log('Upload is running');
                    break;
            }
            }, function(error) {
            // Handle unsuccessful uploads
            }, function() {
                // Handle successful uploads on complete
                // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                console.log('File available at', downloadURL);

                //inserir o caminho url no firebase database
                var database = firebase.database();
                var fruitRef = database.ref('eventos');
                var postId = fruitRef.push().key;

                var adicionarRef = firebase.database().ref('eventos/'+postId);
                adicionarRef.update({
                    url: downloadURL,
                    image_name:selectedFile.name,
                    nome_evento: nome_evento,
                    data_evento: data_evento,
                    hora_inicio: hora_inicio,
                    hora_termino: hora_termino,
                    duracao: hora,
                    cabecalho_evento: cabecalho_evento,
                    textoprincipal_evento: textoprincipal_evento,
                    textosecundario_evento: textosecundario_evento,
                    rodape_evento: rodape_evento,
                    valor: valor,
                    valor_rec:"",
                    valor_rec_data:"",
                    valor_rec_desconto:"",
                    compareceu: false,
                    pagou: false
                    
                });
                //alert('el.style.width = '+el.style.width);
                if(el.style.width==="100%"){
                    //alert('dentro do if');
                    document.getElementById('progressBar').style.display = "none";
                    document.getElementById('image').src = "img/semimagem.png";
                }else{
                    alert('Upload de imagem falhou...');
                }
                el.style.width = "0%";
                alert('Upload de Imagem Bem Sucedido.');
                reset_campos();
                });
                //reset_campos();
            });
            }else{
                alert('O nome do evento e a data são obrigatEorios...');
            }
        }else{
            alert('Horário de Término tem que ser maiór que horário de Início');
        }
        

    }
    
    function reset_campos(){
        document.getElementById('nome_evento').value="";
        document.getElementById('data_evento').value="";
        document.getElementById('cabecalho_evento').value="";
        document.getElementById('textoprincipal_evento').value="";
        document.getElementById('textosecundario_evento').value="";
        document.getElementById('rodape_evento').value="";
        document.getElementById('horaDeInicio').value=0;
        document.getElementById('horaDeTermino').value=0;
        document.getElementById('15Minutos').checked=true;
        document.getElementById('valor').value=0;
    }

</script>

</body>
</html>
